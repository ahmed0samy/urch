const notiCont=document.querySelector(".notification"),notiText=document.querySelector(".msg");function htmlContent(e){return`\n         <img class="logo" src="/logo.png" alt="" />\n  <h1>List of all formulas and data you will need</h1>\n    <div class="grid-table">\n    <div class="header">Element</div>\n    <div class="header">Electrode Reaction</div>\n    <div class="header">E° (V)</div>\n\n    <div>Li</div><div>Li<sup>+</sup> + e<sup>−</sup> → Li</div><div>-3.045</div>\n    <div>K</div><div>K<sup>+</sup> + e<sup>−</sup> → K</div><div>-2.925</div>\n    <div>Cs</div><div>Cs<sup>+</sup> + e<sup>−</sup> → Cs</div><div>-2.923</div>\n    <div>Ba</div><div>Ba<sup>2+</sup> + 2e<sup>−</sup> → Ba</div><div>-2.906</div>\n    <div>Ca</div><div>Ca<sup>2+</sup> + 2e<sup>−</sup> → Ca</div><div>-2.866</div>\n    <div>Na</div><div>Na<sup>+</sup> + e<sup>−</sup> → Na</div><div>-2.714</div>\n    <div>Mg</div><div>Mg<sup>2+</sup> + 2e<sup>−</sup> → Mg</div><div>-2.363</div>\n    <div>Al</div><div>Al<sup>3+</sup> + 3e<sup>−</sup> → Al</div><div>-1.662</div>\n    <div>H<sub>2</sub>O</div><div>H<sub>2</sub>O + 2e<sup>−</sup> → H<sub>2</sub> + 2OH<sup>−</sup></div><div>-0.829</div>\n    <div>Zn</div><div>Zn<sup>2+</sup> + 2e<sup>−</sup> → Zn</div><div>-0.763</div>\n    <div>Fe</div><div>Fe<sup>2+</sup> + 2e<sup>−</sup> → Fe</div><div>-0.440</div>\n    <div>Cd</div><div>Cd<sup>2+</sup> + 2e<sup>−</sup> → Cd</div><div>-0.403</div>\n    <div>PbSO<sub>4</sub></div><div>PbSO<sub>4</sub> + 2e<sup>−</sup> → Pb + SO<sub>4</sub><sup>2−</sup></div><div>-0.310</div>\n    <div>Co</div><div>Co<sup>2+</sup> + 2e<sup>−</sup> → Co</div><div>-0.280</div>\n    <div>Ni</div><div>Ni<sup>2+</sup> + 2e<sup>−</sup> → Ni</div><div>-0.250</div>\n    <div>Sn</div><div>Sn<sup>2+</sup> + 2e<sup>−</sup> → Sn</div><div>-0.136</div>\n    <div>Pb</div><div>Pb<sup>2+</sup> + 2e<sup>−</sup> → Pb</div><div>-0.126</div>\n    <div>Fe</div><div>Fe<sup>3+</sup> + 3e<sup>−</sup> → Fe</div><div>-0.036</div>\n    <div>H<sub>2</sub></div><div>2H<sup>+</sup> + 2e<sup>−</sup> → H<sub>2</sub> (SHE)</div><div>0</div>\n    <div>Cu</div><div>Cu<sup>2+</sup> + e<sup>−</sup> → Cu<sup>+</sup></div><div>+0.153</div>\n    <div>S</div><div>S<sub>4</sub>O<sub>6</sub><sup>2−</sup> + 2e<sup>−</sup> → 2S<sub>2</sub>O<sub>3</sub><sup>2−</sup></div><div>+0.170</div>\n    <div>Cu</div><div>Cu<sup>2+</sup> + 2e<sup>−</sup> → Cu</div><div>+0.337</div>\n    <div>I<sub>2</sub></div><div>I<sub>2</sub> + 2e<sup>−</sup> → 2I<sup>−</sup></div><div>+0.534</div>\n    <div>Fe</div><div>Fe<sup>3+</sup> + e<sup>−</sup> → Fe<sup>2+</sup></div><div>+0.770</div>\n    <div>Ag</div><div>Ag<sup>+</sup> + e<sup>−</sup> → Ag</div><div>+0.799</div>\n    <div>Hg</div><div>Hg<sup>2+</sup> + 2e<sup>−</sup> → Hg</div><div>+0.854</div>\n    <div>Br<sub>2</sub></div><div>Br<sub>2</sub> + 2e<sup>−</sup> → 2Br<sup>−</sup></div><div>+1.066</div>\n    <div>O<sub>2</sub></div><div>O<sub>2</sub> + 4H<sup>+</sup> + 2e<sup>−</sup> → 2H<sub>2</sub>O</div><div>+1.230</div>\n    <div>Cr</div><div>Cr<sub>2</sub>O<sub>7</sub><sup>2−</sup> + 14H<sup>+</sup> + 6e<sup>−</sup> → 2Cr<sup>3+</sup> + 7H<sub>2</sub>O</div><div>+1.330</div>\n    <div>Cl<sub>2</sub></div><div>Cl<sub>2</sub> + 2e<sup>−</sup> → 2Cl<sup>−</sup></div><div>+1.359</div>\n    <div>Au</div><div>Au<sup>3+</sup> + 3e<sup>−</sup> → Au</div><div>+1.498</div>\n    <div>Mn</div><div>MnO<sub>4</sub><sup>−</sup> + 8H<sup>+</sup> + 5e<sup>−</sup> → Mn<sup>2+</sup> + 4H<sub>2</sub>O</div><div>+1.510</div>\n    <div>F<sub>2</sub></div><div>F<sub>2</sub> + 2e<sup>−</sup> → 2F<sup>−</sup></div><div>+2.870</div>\n  </div>\n  <h3 id="timer"></h3>\n  <video id="cameraPreview" autoplay muted playsinline></video>\n <div class="countdown-wrapper">\n <div class="time-text" id="time">Time left: 10:00</div>\n <div class="bar-container">\n <div class="countdown-bar" id="bar" style="width: 100%;"></div>\n </div>\n </div>\n <img src="https://res.cloudinary.com/drsg8lcbn/image/upload/v1752576131/periodic_table_xlaiyd.png" class="periodic" />\n<img class='container' src="https://res.cloudinary.com/drsg8lcbn/image/upload/v1752576120/constants_dv3cup.png" />\n <h1>Exam</h1>\n  <iframe\n  class="visible"\n    id="examFrame"\n    src="${e}"\n    width="100%"\n    height="100%"\n  ></iframe>`}function showNoti(e,i){notiText.innerText=e,notiCont.classList.remove("inactive"),notiCont.offsetWidth,notiCont.classList.add("active"),notiCont.addEventListener("click",(()=>{notiCont.classList.remove("active"),notiCont.classList.add("inactive")})),setTimeout((()=>{notiCont.classList.remove("active"),notiCont.classList.add("inactive")}),i+1e3)}const sliders=document.querySelectorAll(".slide"),warnErrorElement=document.getElementById("warnerror");console.log(warnErrorElement),sliders.forEach(((e,i)=>{e.style.left=100*i+"vw"}));const nextBtn=document.querySelectorAll(".next")[0],permissionNextBtn=document.querySelectorAll(".next")[1];let currentSliden=1;nextBtn.addEventListener("click",(e=>{sliders.forEach(((e,i)=>{e.style.left=100*(i-1)+"vw"}))})),permissionNextBtn.addEventListener("click",(e=>{sliders.forEach(((e,i)=>{e.style.left=100*(i-2)+"vw"}))})),setTimeout((()=>{document.body.classList.add("reddish")}),1e3);const socket=io(),examTime=1800;let remainingSeconds=1800,monitoringStarted=!1,isSuspicious=0;const urlParams=new URLSearchParams(window.location.search),token=urlParams.get("user"),sessionToken=sessionStorage.getItem("exam-token");async function getMonitorCount(){if(!window.isSecureContext)return console.warn("This page must be served over HTTPS to access screen details."),warnError("Please access this site over HTTPS to proceed.",3e3,!1,!0),1;if(!window.getScreenDetails)return console.warn("getScreenDetails not supported in this browser."),1;try{const e=await navigator.permissions.query({name:"window-management"});if("granted"===e.state){return(await window.getScreenDetails()).screens.length}if("prompt"!==e.state)throw new Error("Window management permission denied. Please enable it in your browser settings.");try{return(await window.getScreenDetails()).screens.length}catch(e){throw console.error("Failed to prompt for window-management permission:",e),new Error("Please allow window management permission in your browser settings (e.g., chrome://settings/content/window-management).")}}catch(e){throw console.error("Error accessing screen details:",e),e}}token&&token===sessionToken||(document.body.innerHTML='          <div class="warnfulpage">\n <h1>❌ Unauthorized access</h1> </div>'),/Android|iPhone|iPad|iPod|Windows Phone/i.test(navigator.userAgent)&&(document.body.innerHTML="<h2>Please use a computer for this exam. Mobile is not supported.</h2>"),document.addEventListener("copy",(e=>e.preventDefault())),document.addEventListener("cut",(e=>e.preventDefault())),document.addEventListener("paste",(e=>e.preventDefault())),document.addEventListener("contextmenu",(e=>e.preventDefault())),document.addEventListener("keydown",(e=>{("F12"===e.key||e.ctrlKey&&e.shiftKey&&["I","J","C"].includes(e.key)||e.ctrlKey&&["U","S"].includes(e.key))&&e.preventDefault()})),setInterval((()=>{(window.outerWidth-window.innerWidth>160||window.outerHeight-window.innerHeight>160)&&(isSuspicious=Math.max(3,isSuspicious),console.warn("DevTools detected"))}),1e3),document.addEventListener("visibilitychange",(()=>{monitoringStarted&&document.hidden&&(isSuspicious=Math.max(1,isSuspicious))})),window.addEventListener("blur",(()=>{remainingSeconds<1790&&(isSuspicious=Math.max(2,isSuspicious))}));let loading=!1,startBtn=document.getElementById("startBtn");function warnError(e,i,s=!0,t){setTimeout((()=>{loading=!1,s||startBtn.classList.remove("disabled")}),i),s&&(warnErrorElement.classList.remove("hidden"),warnErrorElement.innerHTML=e),t&&showNoti(e,i)}function warnCheater(){document.body.innerHTML+='\n          <div class="warnfulpage">\n            <video id="myVideo" autoplay muted>\n              <source src="https://res.cloudinary.com/drsg8lcbn/video/upload/v1752576123/cheater_gjafj7.mp4" type="video/mp4">\n              Your browser does not support the video tag.\n            </video>\n            <h1>Bye!</h1>\n            <span>We warned you, isn\'t that?</span>\n          </div>\n        '}async function startExam(){warnErrorElement.classList.add("hidden"),warnErrorElement.innerHTML="";const e=document.getElementById("email").value.trim();if(!e.includes("@"))return warnError("This email is invalid!",2e3,!0,!0),loading=!1,void startBtn.classList.remove("disabled");let i,s,t;try{if(i=await getMonitorCount(),i>1)return warnError("Please disconnect additional monitors.",2e3,!1,!0),loading=!1,void startBtn.classList.remove("disabled")}catch(e){return console.error("Window management permission error:",e),warnError(e.message||"Please allow window management permission in your browser settings (e.g., chrome://settings/content/window-management).",4e3,!1,!0),loading=!1,void startBtn.classList.remove("disabled")}try{const e=await navigator.permissions.query({name:"camera"});if("granted"!==e.state&&"prompt"!==e.state)throw new Error("Camera permission denied");s=await navigator.mediaDevices.getUserMedia({video:!0})}catch(e){return console.error("Camera permission error:",e),warnError("You must allow camera access to proceed.",2e3,!0,!0),loading=!1,void startBtn.classList.remove("disabled")}try{t=await navigator.mediaDevices.getDisplayMedia({video:!0})}catch(e){return console.error("Screen-sharing permission error:",e),warnError("You must allow screen-sharing to proceed.",2e3,!0,!0),s.getTracks().forEach((e=>e.stop())),loading=!1,void startBtn.classList.remove("disabled")}socket.emit("exam-start",e,(async i=>{if(!i.allowed){switch(i.reason){case"not_registered":warnError("This email isn't registered in registration form!",6e3,!0,!0);break;case"already_attended":warnError("You have already attended the exam!",6e3,!1,!0);break;default:warnError("An error has occurred! Please refresh the page and try again.",2e3,!1,!0)}return s.getTracks().forEach((e=>e.stop())),t.getTracks().forEach((e=>e.stop())),loading=!1,void startBtn.classList.remove("disabled")}sliders.forEach(((e,i)=>{e.style.left=100*(i-2)+"vw"}));const n=document.querySelector(".black");n.style.right="0",setTimeout((()=>{n.style.right="100vw",document.body.classList.add("dark"),document.body.classList.remove("reddish"),document.body.classList.add("scroll"),document.body.classList.remove("unscroll"),document.body.innerHTML=htmlContent(i.link);document.getElementById("cameraPreview").srcObject=s,timeDisplay=document.getElementById("time"),bar=document.getElementById("bar");const d=remainingSeconds/1800*100;bar.style.width=d+"%",monitoringStarted=!0,socket.emit("user-join",e);const r=document.createElement("video");r.srcObject=t,r.play();const o=document.createElement("canvas");o.width=9600/9,o.height=600;const a=o.getContext("2d"),u=setInterval((()=>{a.drawImage(r,0,0,o.width,o.height)}),1e3),v=o.captureStream(1),c=new MediaRecorder(v,{mimeType:"video/webm;codecs=vp8",videoBitsPerSecond:1e7});c.ondataavailable=i=>{i.data.size>0&&i.data.arrayBuffer().then((i=>{socket.emit("video-chunk",{userId:e,chunk:i})}))},c.start(1e3);const l=setInterval((()=>{remainingSeconds--,function(){const e=Math.floor(remainingSeconds/60),i=String(remainingSeconds%60).padStart(2,"0"),s=remainingSeconds/1800*100;bar.style.width=s+"%",timeDisplay.textContent=`Time Left: ${e}:${i}`}(),remainingSeconds<=0&&(clearInterval(l),clearInterval(u),c.stop(),socket.emit("user-suspicion",{userId:e,isSuspicious:isSuspicious}),window.focus(),setTimeout((()=>{window.open("","_self"),window.close()}),100))}),1e3),p=setInterval((async()=>{try{await getMonitorCount()>1&&(warnCheater(),clearInterval(p),setTimeout((()=>{window.focus(),window.close()}),1e4))}catch(e){console.error("Monitor check error:",e),warnCheater(),clearInterval(p),setTimeout((()=>{window.focus(),window.close()}),1e4)}}),5e3);window.addEventListener("beforeunload",(()=>{c.stop(),clearInterval(u),socket.emit("user-suspicion",{userId:e,isSuspicious:isSuspicious})}))}),1e3)}))}startBtn.addEventListener("click",(()=>{loading||(loading=!0,startBtn.classList.add("disabled"),startExam())}));